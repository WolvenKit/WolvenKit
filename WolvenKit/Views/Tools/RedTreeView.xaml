<UserControl
    x:Class="WolvenKit.Views.Tools.RedTreeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:WolvenKit.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:local="clr-namespace:WolvenKit.Views.Tools"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shell="clr-namespace:WolvenKit.App.ViewModels.Shell;assembly=WolvenKit.App"
    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
    xmlns:treeViewEngine="clr-namespace:Syncfusion.UI.Xaml.TreeView.Engine;assembly=Syncfusion.SfTreeView.WPF"
    x:Name="redTreeView"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <Style x:Key="PropertyKeyStyle" TargetType="TextBlock">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Value, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="null">
                        <Setter Property="Foreground" Value="{StaticResource Border}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsDefault, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="True">
                        <Setter Property="Foreground" Value="{StaticResource BorderAlt2}" />
                        <Setter Property="FontStyle" Value="Italic" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsReadOnly}" Value="True">
                        <Setter Property="Foreground" Value="{StaticResource WolvenKitTan50}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="PropertyValueStyle" TargetType="TextBlock">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Value, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="null">
                        <Setter Property="Foreground" Value="{StaticResource Border}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsDefault, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="True">
                        <Setter Property="Foreground" Value="{StaticResource BorderAlt2}" />
                        <Setter Property="FontStyle" Value="Italic" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsReadOnly}" Value="True">
                        <Setter Property="Foreground" Value="{StaticResource WolvenKitTan50}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsValueExtrapolated, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="True">
                        <Setter Property="Foreground" Value="{StaticResource BorderAlt2}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <DataTemplate x:Key="PropertyNameTemplate" DataType="{x:Type shell:ChunkViewModel}">
                <Grid>
                    <Grid.Resources>
                        <Style x:Key="ExpanderHider" TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type syncfusion:TreeViewItem}}}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsDefault, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource BorderAlt2}" />
                                    <Setter Property="FontStyle" Value="Italic" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsReadOnly}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource WolvenKitTan50}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDefault, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource BorderAlt2}" />
                                    <Setter Property="FontStyle" Value="Italic" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsReadOnly}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource WolvenKitTan50}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Resources>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Grid.Column="1"
                        Width="Auto"
                        Margin="0,0,0,2"
                        Text="{Binding Name, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock
                        Grid.Column="2"
                        Width="Auto"
                        Margin="0,0,0,2"
                        Foreground="{StaticResource Border}"
                        Style="{StaticResource ExpanderHider}"
                        Text="{Binding Type, StringFormat=' {0}'}" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="GroupedPropertyNameTemplate" DataType="{x:Type shell:GroupedChunkViewModel}">
                <Grid>
                    <TextBlock
                        Width="Auto"
                        Margin="0,0,0,2"
                        Text="{Binding Name}" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="PropertyValueTemplate" DataType="{x:Type shell:ChunkViewModel}">
                <Grid>
                    <Grid.Resources>
                        <Style TargetType="{x:Type TextBlock}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDefault, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource BorderAlt2}" />
                                    <Setter Property="FontStyle" Value="Italic" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                        <Style TargetType="{x:Type iconPacks:PackIconCodicons}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDefault, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource BorderAlt2}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Resources>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <iconPacks:PackIconCodicons
                        Width="15"
                        Height="15"
                        Margin="0,0,6,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Kind="{Binding Extension}" />
                    <StackPanel
                        Grid.Column="1"
                        Margin="0,0,4,0"
                        Orientation="Horizontal">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Value, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock
                            Name="PropertyType"
                            Foreground="{StaticResource WolvenKitTan}"
                            Text="{Binding Type}" />
                        <StackPanel Orientation="Horizontal">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding TypesDiffer, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="False">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            <iconPacks:PackIconCodicons
                                Height="7"
                                VerticalAlignment="Center"
                                Kind="ArrowRight" />
                            <TextBlock Foreground="{StaticResource WolvenKitTan}" Text="{Binding ResolvedType, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>
                    </StackPanel>
                    <StackPanel
                        Grid.Column="2"
                        Margin="0,0,4,0"
                        Orientation="Horizontal">
                        <TextBlock
                            Name="PropertyDescriptor"
                            Margin="0,0,4,2"
                            Style="{StaticResource PropertyKeyStyle}"
                            Text="{Binding Descriptor, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Name="PropertyValue"
                            Margin="0,0,0,2"
                            Style="{StaticResource PropertyValueStyle}"
                            Text="{Binding Value, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                            TextTrimming="CharacterEllipsis" />
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <Style x:Key="ArrayNameColumnWidth" TargetType="ColumnDefinition">
                <Setter Property="Width" Value="218" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Level}" Value="1">
                        <Setter Property="Width" Value="200" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="2">
                        <Setter Property="Width" Value="180" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="3">
                        <Setter Property="Width" Value="160" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="4">
                        <Setter Property="Width" Value="140" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="5">
                        <Setter Property="Width" Value="120" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="6">
                        <Setter Property="Width" Value="100" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="7">
                        <Setter Property="Width" Value="100" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="8">
                        <Setter Property="Width" Value="100" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="9">
                        <Setter Property="Width" Value="100" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Level}" Value="10">
                        <Setter Property="Width" Value="100" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsInArray}" Value="True">
                        <Setter Property="Width" Value="{Binding ArrayIndexWidth}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Name, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Value="{x:Null}">
                        <Setter Property="Width" Value="0" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <ContextMenu x:Key="TreeViewContextMenu" DataContext="{Binding Path=PlacementTarget, RelativeSource={RelativeSource Self}}">
                <ContextMenu.Resources>
                    <Style TargetType="MenuItem">
                        <Style.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ContextMenu.Resources>

                <MenuItem
                    Header="TweakXL"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowTweakXLMenu, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="DatabaseExportOutline" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                    <MenuItem
                        Command="{Binding Path=PlacementTarget.Tag.CreateTXLOverrideCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                        Header="Override Value"
                        IsCheckable="False"
                        Style="{StaticResource SyncfusionMenuItemStyle}" />
                    <MenuItem
                        Command="{Binding Path=PlacementTarget.Tag.CopyTXLOverrideCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                        Header="Copy to Clipboard"
                        IsCheckable="False"
                        Style="{StaticResource SyncfusionMenuItemStyle}" />
                </MenuItem>

                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.OpenChunkCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Open in New Tab"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="References" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.AddItemToCompiledDataCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Create Item In Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentDuplicate" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.SaveBufferToDiskCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Save Buffer To Disk"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentSave" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.LoadBufferFromDiskCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Load Buffer From Disk"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="FolderOpen" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.DuplicateChunkCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Duplicate Item in Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDuplicate, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Style="{StaticResource ContextMenuIconStyleMaterial}" Kind="ContentDuplicate" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.DuplicateAsNewChunkCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Duplicate as new Item"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDuplicateAsNew, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentDuplicate" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.RenameDynamicClassCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Rename Class"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDynamicClassOperations, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial
                            Width="13"
                            Height="13"
                            Padding="0,0,0,0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Kind="Text" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.RenamePropertyCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Rename Property"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDynamicPropertyOperations, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial
                            Width="13"
                            Height="13"
                            Padding="0,0,0,0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Kind="Text" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.DeletePropertyCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Delete Property"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDynamicPropertyOperations, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons
                            Width="13"
                            Height="13"
                            Padding="0,0,0,0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Kind="Remove" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.CopyHandleCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Copy Handle"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowHandleOperations, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentCopy" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.CopyChunkCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Copy From Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowArrayOps, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentCopy" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.CopySelectionCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Copy Selection From Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowArrayOps, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">

                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentCopy" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--  Paste Selection To Array/Buffer  -->
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.PasteSelectionCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Paste Selection To Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowPasteIntoArray, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">

                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentPaste" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--  Overwrite Array/Buffer With Selection  -->
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.ClearAndPasteSelectionCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Clear Array/Buffer and Paste Selection"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowOverwriteArray, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">

                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentPaste" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--  Paste Handle  -->
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.PasteHandleCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Paste Handle"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowHandleOperations, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentPaste" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--  Paste Into Array/Buffer  -->
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.PasteChunkCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Paste Into Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowPasteIntoArray, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">

                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentPaste" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--  Clear Array/Buffer and Paste  -->
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.ClearAndPasteChunkCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Clear Array/Buffer and Paste"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowOverwriteArray, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">

                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="ContentPaste" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.ExportChunkCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Export to JSON"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="Json" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.ExportNodeDataCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Export NodeData to JSON"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowExportNodeData, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="Json" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.ImportWorldNodeDataCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Import from JSON to worldStreamingSector"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowWorldNodeDataImport, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="Json" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.ImportWorldNodeDataWithoutCoordsCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Import from JSON (no coords update)"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowWorldNodeDataImport, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="Json" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="ApplicationCommands.Copy"
                    CommandParameter="{Binding}"
                    CommandTarget="{Binding}"
                    Header="Copy Value to Clipboard"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="Copy" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Delete Item in Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowArrayOps, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="Remove" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.DeleteSelectionCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Delete Selection in Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowArrayOps, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconCodicons Kind="Remove" Style="{StaticResource ContextMenuIconStyleCodicons}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.DeleteAllCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Delete All Items in Array/Buffer"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowArrayOps, RelativeSource={RelativeSource AncestorType=ContextMenu}, Converter={StaticResource BooleanToVisibilityConverter}}">

                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="NotificationClearAll" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.RegenerateAppearanceVisualControllerCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Regenerate Appearance Dependencies"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="Refresh" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.ResetObjectCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Reset Object"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="Delete" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.GenerateCRUIDCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Generate new CRUID"
                    IsCheckable="False"
                    Style="{StaticResource SyncfusionMenuItemStyle}"
                    Visibility="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <iconPacks:PackIconMaterial Kind="Dice3Outline" Style="{StaticResource ContextMenuIconStyleMaterial}" />
                    </MenuItem.Icon>
                </MenuItem>
            </ContextMenu>

            <converters:TreeViewItemTemplateSelector x:Key="itemTemplateSelector" x:Name="itemTemplateSelector">
                <converters:TreeViewItemTemplateSelector.GroupedTemplate>
                    <DataTemplate>
                        <Grid Background="Transparent" Tag="{Binding}">
                            <ContentPresenter
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource GroupedPropertyNameTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.GroupedTemplate>
                <converters:TreeViewItemTemplateSelector.PropertyTemplate>
                    <DataTemplate DataType="{x:Type shell:ChunkViewModel}">
                        <Grid
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.CommandBindings>
                                <CommandBinding
                                    CanExecute="Copy_CanExecute"
                                    Command="ApplicationCommands.Copy"
                                    Executed="Copy_Executed" />
                            </Grid.CommandBindings>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ContentPresenter
                                Grid.Column="0"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />
                            <ContentPresenter
                                Grid.Column="2"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.PropertyTemplate>
                <converters:TreeViewItemTemplateSelector.ArrayTemplate>
                    <DataTemplate>
                        <Grid
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ContentPresenter
                                Grid.Column="0"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />
                            <ContentPresenter
                                Grid.Column="2"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.ArrayTemplate>
                <converters:TreeViewItemTemplateSelector.HandleTemplate>
                    <DataTemplate>
                        <Grid
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ContentPresenter
                                Grid.Column="0"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />
                            <ContentPresenter
                                Grid.Column="1"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.HandleTemplate>
                <converters:TreeViewItemTemplateSelector.RefTemplate>
                    <DataTemplate>
                        <Grid
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" MinWidth="20" />
                                <ColumnDefinition Width="Auto" MinWidth="20" />
                            </Grid.ColumnDefinitions>
                            <ContentPresenter
                                Grid.Column="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />
                            <!--iconPacks:PackIconCodicons Kind="References" Height="14" Grid.Column="1"
                                    Width="14" VerticalAlignment="Center" HorizontalAlignment="Center"  Margin="0,0,6,0" />
                                <TextBlock Text="{Binding Value}" Grid.Column="2" /-->
                            <ContentPresenter
                                Grid.Column="1"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />
                            <Button
                                Grid.Column="2"
                                Margin="5,0,0,0"
                                Background="Transparent"
                                Command="{Binding OpenRefCommand}"
                                Style="{StaticResource ButtonCustom}"
                                ToolTip="Open in new tab">
                                <iconPacks:PackIconVaadinIcons
                                    Padding="2"
                                    VerticalAlignment="Center"
                                    Foreground="{StaticResource WolvenKitCyan}"
                                    Kind="ArrowCircleUp"
                                    RotationAngle="45" />
                            </Button>
                            <Button
                                Grid.Column="3"
                                Margin="5,0,0,0"
                                Background="Transparent"
                                Command="{Binding AddRefCommand}"
                                Style="{StaticResource ButtonCustom}"
                                ToolTip="Add File to Mod">
                                <iconPacks:PackIconVaadinIcons
                                    Padding="2"
                                    VerticalAlignment="Center"
                                    Foreground="{StaticResource WolvenKitYellow}"
                                    Kind="ArrowCircleLeft" />
                            </Button>
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.RefTemplate>
            </converters:TreeViewItemTemplateSelector>

        </ResourceDictionary>
    </UserControl.Resources>

    <syncfusion:SfTreeView
        x:Name="TreeView"
        AllowDragging="True"
        AllowEditing="False"
        AutoExpandMode="RootNodes"
        Background="{StaticResource ContentBackground}"
        BorderThickness="0"
        ItemDragOver="SfTreeView_ItemDragOver"
        ItemDragStarting="SfTreeView_ItemDragStarting"
        ItemDropped="SfTreeView_ItemDropped"
        ItemDropping="SfTreeView_ItemDropping"
        ItemTemplateSelector="{StaticResource itemTemplateSelector}"
        ItemsSource="{Binding ElementName=redTreeView, Path=ItemsSource, Mode=TwoWay}"
        NodeCollapsed="OnCollapsed"
        SelectedItem="{Binding ElementName=redTreeView, Path=SelectedItem, Mode=TwoWay}"
        SelectedItems="{Binding ElementName=redTreeView, Path=SelectedItems, Mode=TwoWay}"
        SelectionChanged="OnSelectionChanged"
        SelectionMode="Extended"
        ShowLines="True"
        VirtualizingPanel.IsVirtualizing="True"
        VirtualizingPanel.ScrollUnit="Pixel"
        VirtualizingPanel.VirtualizationMode="Recycling"
        Visibility="Visible">
        <!--
            LoadOnDemandCommand="{Binding OnDemandLoadingCommand}"
            QueryNodeSize="TreeView_QueryNodeSize"
        -->
        <syncfusion:SfTreeView.DragPreviewTemplate>
            <DataTemplate DataType="{x:Type syncfusion:TreeViewDragInfo}">
                <Border BorderBrush="{StaticResource BorderAlt}" BorderThickness="1">
                    <Grid Background="{StaticResource ContentBackgroundAlt2}">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Margin="5,2,5,0"
                            VerticalAlignment="Center"
                            Text="Duplicate item to this index (release control to move)"
                            Visibility="{Binding Data[0].Content.IsControlBeingHeld, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        <TextBlock
                            Grid.Row="0"
                            Margin="5,2,5,0"
                            VerticalAlignment="Center"
                            Text="Move item to this index (hold control to duplicate)"
                            Visibility="{Binding Data[0].Content.IsControlBeingHeld, Converter={StaticResource InvertBooleanVisibilityConverter}}" />
                        <StackPanel Grid.Row="1" Orientation="Horizontal">
                            <TextBlock
                                Margin="5,0,5,2"
                                VerticalAlignment="Center"
                                Foreground="{StaticResource WolvenKitTan}"
                                Text="{Binding Data[0].Content.Type}" />
                            <TextBlock
                                Margin="0,0,5,2"
                                VerticalAlignment="Center"
                                Text="{Binding Data[0].Content.Descriptor}" />

                        </StackPanel>
                    </Grid>
                </Border>
            </DataTemplate>
        </syncfusion:SfTreeView.DragPreviewTemplate>
        <syncfusion:SfTreeView.HierarchyPropertyDescriptors>
            <treeViewEngine:HierarchyPropertyDescriptor
                ChildPropertyName="TVProperties"
                IsExpandedPropertyName="IsExpanded"
                TargetType="{x:Type shell:ChunkViewModel}" />
            <treeViewEngine:HierarchyPropertyDescriptor
                ChildPropertyName="TVProperties"
                IsExpandedPropertyName="IsExpanded"
                TargetType="{x:Type shell:GroupedChunkViewModel}" />
        </syncfusion:SfTreeView.HierarchyPropertyDescriptors>
    </syncfusion:SfTreeView>
</UserControl>
