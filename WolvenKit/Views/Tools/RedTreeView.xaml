<UserControl
    x:Class="WolvenKit.Views.Tools.RedTreeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:WolvenKit.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shell="clr-namespace:WolvenKit.App.ViewModels.Shell;assembly=WolvenKit.App"
    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
    xmlns:treeViewEngine="clr-namespace:Syncfusion.UI.Xaml.TreeView.Engine;assembly=Syncfusion.SfTreeView.WPF"
    xmlns:templates="clr-namespace:WolvenKit.Views.Templates"
    xmlns:editors="clr-namespace:WolvenKit.Views.Editors"
    mc:Ignorable="d"
    d:DesignWidth="800"
    d:DesignHeight="450"
    x:Name="redTreeView"
    KeyDown="TreeView_OnKeyChanged"
    KeyUp="TreeView_OnKeyChanged">
    <UserControl.Resources>
        <ResourceDictionary>
            <!-- StackPanel: empty value style -->
            <Style
                x:Key="VisibleOnEmptyValueStyle"
                TargetType="StackPanel">
                <Setter Property="Visibility" Value="Collapsed" />
                <Style.Triggers>
                    <DataTrigger
                        Binding="{Binding Value,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="">
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsValueExtrapolated,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="True">
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- PropertyKeyStyle for TextBlock -->
            <Style
                x:Key="PropertyKeyStyle"
                TargetType="TextBlock">
                <Style.Triggers>
                    <DataTrigger
                        Binding="{Binding Value,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="null">
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsDefault,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="True">
                        <Setter Property="FontStyle" Value="Italic" />
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey_Dark}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding DisplayAsArrayItem,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="True">
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey_Dark}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsReadOnly}"
                        Value="True">
                        <Setter Property="FontStyle" Value="Italic" />
                        <Setter Property="Foreground" Value="{StaticResource WolvenKitTan50}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsDisplayAsReadOnly}"
                        Value="True">
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- Text block -->
            <Style
                x:Key="PropertyValueStyle"
                TargetType="TextBlock">
                <Style.Triggers>
                    <DataTrigger
                        Binding="{Binding Value,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="null">
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsDefault,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="True">
                        <Setter Property="FontStyle" Value="Italic" />
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey_Dark}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsReadOnly}"
                        Value="True">
                        <Setter Property="Foreground" Value="{StaticResource WolvenKitTan50}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsDisplayAsReadOnly}"
                        Value="True">
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsValueExtrapolated,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="True">
                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey_Dark}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- Property name -->
            <DataTemplate
                x:Key="PropertyNameTemplate"
                DataType="{x:Type shell:ChunkViewModel}">
                <Grid>
                    <Grid.Resources>
                        <Style
                            x:Key="ExpanderHider"
                            TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding IsMouseOver,
                                                      RelativeSource={RelativeSource AncestorType={x:Type syncfusion:TreeViewItem}}}"
                                    Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsDefault,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="FontStyle" Value="Italic" />
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey_Dark}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsReadOnly}"
                                    Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource WolvenKitTan50}" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsDisplayAsReadOnly}">
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Resources>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Column="0"
                        Style="{StaticResource PropertyKeyStyle}"
                        Text="{Binding DisplayName,
                                       Mode=OneWay,
                                       UpdateSourceTrigger=PropertyChanged}" />

                    <TextBlock
                        Grid.Column="1"
                        Margin="{DynamicResource WolvenKitMarginTinyRight}"
                        VerticalAlignment="Center"
                        Foreground="{StaticResource ForegroundColor_Grey1}"
                        Style="{StaticResource ExpanderHider}"
                        Text="{Binding Type,
                                       StringFormat=' {0}'}" />
                </Grid>
            </DataTemplate>

            <!-- GroupedPropertyNameTemplate for GroupedChunkViewModel -->
            <DataTemplate
                x:Key="GroupedPropertyNameTemplate"
                DataType="{x:Type shell:GroupedChunkViewModel}">
                <Grid>
                    <TextBlock
                        Width="Auto"
                        VerticalAlignment="Center"
                        Text="{Binding DisplayName}" />
                </Grid>
            </DataTemplate>

            <!-- PropertyValueTemplate for ChunkViewModel -->
            <DataTemplate
                x:Key="PropertyValueTemplate"
                DataType="{x:Type shell:ChunkViewModel}">
                <Grid>
                    <Grid.Resources>
                        <Style TargetType="{x:Type TextBlock}">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding IsDefault,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="FontStyle" Value="Italic" />
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey_Dark}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsReadOnly,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="FontStyle" Value="Italic" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsDisplayAsReadOnly,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsReadOnly,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="FontStyle" Value="Italic" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsDisplayAsReadOnly,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>

                        <Style TargetType="{x:Type iconPacks:PackIconCodicons}">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding IsDefault,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey_Dark}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsReadOnly,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="FontStyle" Value="Italic" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsDisplayAsReadOnly,
                                                      Mode=OneWay,
                                                      UpdateSourceTrigger=PropertyChanged}"
                                    Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor_Grey1}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Resources>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="{DynamicResource WolvenKitRedTreeIconColumnWidth}" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <iconPacks:PackIconCodicons
                        Kind="{Binding Extension}"
                        Width="{DynamicResource WolvenKitIconMicro}"
                        Height="{DynamicResource WolvenKitIconMicro}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center" />

                    <StackPanel
                        Name="PropertyTypeDescriptor"
                        Grid.Column="1"
                        Margin="{DynamicResource WolvenKitMarginTinyRight}"
                        Style="{StaticResource VisibleOnEmptyValueStyle}"
                        Orientation="Horizontal">
                        <TextBlock
                            Name="PropertyType"
                            Foreground="{StaticResource WolvenKitTan}"
                            Text="{Binding Type}" />
                        <!-- icon -->
                        <StackPanel Orientation="Horizontal">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Style.Triggers>
                                        <DataTrigger
                                            Binding="{Binding TypesDiffer,
                                                              Mode=OneWay,
                                                              UpdateSourceTrigger=PropertyChanged}"
                                            Value="False">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <iconPacks:PackIconCodicons
                                Kind="ArrowRight"
                                Height="{DynamicResource WolvenKitIconNano}"
                                Margin="{DynamicResource WolvenKitMarginTinyHorizontal}"
                                VerticalAlignment="Center" />

                            <TextBlock
                                Foreground="{StaticResource WolvenKitTan}"
                                Text="{Binding ResolvedType,
                                               Mode=OneWay,
                                               UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>
                    </StackPanel>

                    <StackPanel
                        Grid.Column="2"
                        Margin="{DynamicResource WolvenKitMarginTinyRight}"
                        Orientation="Horizontal">
                        <TextBlock
                            Name="PropertyDescriptor"
                            Margin="{DynamicResource WolvenKitMarginTinyRight}"
                            Style="{StaticResource PropertyKeyStyle}"
                            Text="{Binding Descriptor,
                                           Mode=OneWay,
                                           UpdateSourceTrigger=PropertyChanged}"
                            TextTrimming="CharacterEllipsis" />

                        <TextBlock
                            Name="PropertyValue"
                            Style="{StaticResource PropertyValueStyle}"
                            Text="{Binding Value,
                                           Mode=OneWay,
                                           UpdateSourceTrigger=PropertyChanged}"
                            TextTrimming="CharacterEllipsis" />
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <!-- ArrayNameColumnWidth for ColumnDefinition -->
            <Style
                x:Key="ArrayNameColumnWidth"
                TargetType="ColumnDefinition">
                <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl0}" />
                <Style.Triggers>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="1">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl1}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="2">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl2}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="3">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl3}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="4">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl4}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="5">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl5}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="6">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl6}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="7">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl6}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="8">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl6}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="9">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl6}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding Level}"
                        Value="10">
                        <Setter Property="Width" Value="{DynamicResource WolvenKitRedTreeArrayColumnWidthLvl6}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding IsInArray}"
                        Value="True">
                        <Setter Property="Width" Value="{Binding ArrayIndexWidth}" />
                    </DataTrigger>
                    <DataTrigger
                        Binding="{Binding DisplayName,
                                          Mode=OneWay,
                                          UpdateSourceTrigger=PropertyChanged}"
                        Value="{x:Null}">
                        <Setter Property="Width" Value="0" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- Context menu -->
            <ContextMenu
                x:Key="TreeViewContextMenu"
                Name="TreeViewContextMenu"
                Style="{StaticResource WPFContextMenuStyle}"
                DataContext="{Binding Path=PlacementTarget,
                                      RelativeSource={RelativeSource Self}}"
                Opened="TreeViewContextMenu_OnOpened"
                Closed="TreeViewContextMenu_OnClosed"
                KeyUp="TreeViewContextMenu_OnKeyChanged"
                KeyDown="TreeViewContextMenu_OnKeyChanged">
                <ContextMenu.Resources>
                    <!-- Named style for sub-style's basedOn -->
                    <Style
                        x:Key="TreeViewMenuItemStyle"
                        BasedOn="{StaticResource WPFMenuItemStyle}"
                        TargetType="MenuItem">
                        <Setter Property="IsCheckable" Value="False" />
                    </Style>
                    <!-- unnamed style for auto-apply of all menu items -->
                    <Style
                        BasedOn="{StaticResource WPFMenuItemStyle}"
                        TargetType="MenuItem">
                        <Setter Property="IsCheckable" Value="False" />
                    </Style>
                </ContextMenu.Resources>

                <!-- TweakXL -->

                <!--
                    #########################################################
                    ╔╦╗┬ ┬┌─┐┌─┐┬┌─═╗ ╦╦
                    ║ │││├┤ ├─┤├┴┐╔╩╦╝║
                    ╩ └┴┘└─┘┴ ┴┴ ┴╩ ╚═╩═╝
                    #########################################################
                -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowTweakXLMenu,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="TweakXL">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="DatabaseExportOutline"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>

                    <!-- Create new Tweak XL Override -->
                    <MenuItem
                        Command="{Binding Path=PlacementTarget.Tag.CreateTXLOverrideCommand,
                                          RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                        Header="Override Value">
                        <MenuItem.Icon>
                            <templates:IconBox
                                IconPack="Empty"
                                Margin="{DynamicResource WolvenKitMarginTiny}"
                                Size="{DynamicResource WolvenKitIconMilli}" />
                        </MenuItem.Icon>
                    </MenuItem>

                    <!-- Copy Tweak XL Override -->
                    <MenuItem
                        Visibility="{Binding Path=IsShiftBeingHeld,
                                             Source={x:Reference redTreeView},
                                             Mode=OneWay,
                                             Converter={StaticResource InvertBooleanVisibilityConverter}}"
                        Header="Copy to Clipboard"
                        Command="{Binding Path=PlacementTarget.Tag.CopyTXLOverrideCommand,
                                          RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                        <MenuItem.Icon>
                            <templates:IconBox
                                IconPack="Material"
                                Kind="ContentCopy"
                                Margin="{DynamicResource WolvenKitMarginTiny}"
                                Size="{DynamicResource WolvenKitIconMilli}" />
                        </MenuItem.Icon>
                    </MenuItem>

                    <!-- Copy Tweak XL Name (with shift key down) -->
                    <MenuItem
                        Visibility="{Binding Path=IsShiftBeingHeld,
                                             Source={x:Reference redTreeView},
                                             Mode=OneWay,
                                             Converter={StaticResource BooleanToVisibilityConverter}}"
                        Header="Copy Name to Clipboard"
                        Command="{Binding Path=PlacementTarget.Tag.CopyTXLOverrideNameCommand,
                                          RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                        <MenuItem.Icon>
                            <templates:IconBox
                                IconPack="Material"
                                Kind="ContentCopy"
                                Margin="{DynamicResource WolvenKitMarginTiny}"
                                Size="{DynamicResource WolvenKitIconMilli}" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>

                <!-- Create Item In Buffer -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Create Item In Buffer"
                    Command="{Binding Path=PlacementTarget.Tag.AddItemToCompiledDataCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="PlusBoxOutline"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Save Buffer To Disk -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Save Buffer To Disk"
                    Command="{Binding Path=PlacementTarget.Tag.SaveBufferToDiskCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <!-- Old icon Material#ContentSave -->
                        <templates:IconBox
                            IconPack="Codicons"
                            Kind="Save"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitCyan}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Load Buffer From Disk -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Load Buffer From Disk"
                    Command="{Binding Path=PlacementTarget.Tag.LoadBufferFromDiskCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="FolderOpen"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Open in New Tab -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Open in New Tab"
                    Command="{Binding Path=PlacementTarget.Tag.OpenChunkCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <!-- Old icon Codicons#References -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="TabPlus"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitCyan}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--
                    #########################################################
                    ╦ ╦┌┬┐┬┬
                    ║ ║ │ ││
                    ╚═╝ ┴ ┴┴─┘
                    #########################################################
                -->

                <Separator />

                <!-- Duplicate (without shift) -->
                <MenuItem
                    Header="Duplicate in Array/Buffer"
                    Command="{Binding DuplicateSelectionCommand,
                                      Source={x:Reference redTreeView}}">
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                        <Condition Binding="{Binding Path=PlacementTarget.Tag.DuplicatesAsNew, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                    <Setter Property="Header" Value="Duplicate in Array/Buffer" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentDuplicate"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>

                </MenuItem>

                <!-- Duplicate (with shift; preserve index) -->
                <MenuItem
                    Header="Duplicate in Array/Buffer (preserve index)"
                    Command="{Binding DuplicateSelectionCommand,
                                      Source={x:Reference redTreeView}}">
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=PlacementTarget.Tag.DuplicatesAsNew, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentDuplicate"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>

                </MenuItem>

                <!-- Duplicate As New Chunk -->
                <MenuItem
                    Header="Duplicate as new Item(s)"
                    Command="{Binding DuplicateSelectionAsNewCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=PlacementTarget.Tag.DuplicatesAsNew, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentDuplicate"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Rename Class -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDynamicClassOperations,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Rename Class"
                    Command="{Binding Path=PlacementTarget.Tag.RenameDynamicClassCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Pencil"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Rename Property -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDynamicPropertyOperations,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Rename Property"
                    Command="{Binding Path=PlacementTarget.Tag.RenamePropertyCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Pencil"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Mesh only -->
                <!-- Rename Material -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.IsMaterial,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Rename Material"
                    Command="{Binding Path=PlacementTarget.Tag.RenameMaterialCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <!-- Old icon Material#RenameBox -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Pencil"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Mesh only -->
                <!-- Add material and definition -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.IsMaterialArray,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Add material and definition"
                    Command="{Binding Path=PlacementTarget.Tag.AddMaterialAndDefinitionCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Plus"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Mesh: Material only -->
                <!-- Toggle IsMasked -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Toggle 'EnableMask'"
                    Command="{Binding Path=PlacementTarget.Tag.ToggleEnableMaskedCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ToggleSwitchOutline"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Search & Replace -->
                <MenuItem
                    Visibility="{Binding Path=HasSelection,
                                         Source={x:Reference redTreeView},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Search and Replace in Selection"
                    Command="{Binding OpenSearchAndReplaceDialogCommand,
                                      Source={x:Reference redTreeView}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="FindReplace"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--
                    For arrays of indexables: Renumber Indices of child nodes, starting at 0
                    Useful if you paste a bunch of material definitions from multiple sources
                -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Recalculate child index properties"
                    Command="{Binding Path=PlacementTarget.Tag.ReindexChildDataIndexPropertiesCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Calculator"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Mesh only -->
                <!-- Scroll to material -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Scroll to material"
                    Command="{Binding Path=PlacementTarget.Tag.ScrollToMaterialCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <!-- Old icon Material#ArrowRight -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="EyeOutline"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Generate CRUID -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Generate new CRUID"
                    Command="{Binding Path=PlacementTarget.Tag.GenerateCRUIDCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Dice3Outline"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Generate child CRUIDs -->
                <MenuItem
                    Header="Generate CRUIDs for all children"
                    Command="{Binding Path=PlacementTarget.Tag.GenerateChildCruidsCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Dice3Outline"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!--
                    #########################################################
                    ╔═╗┌─┐┌─┐┬ ┬ ┬ ╔═╗┌─┐┌─┐┌┬┐┌─┐
                    ║  │ │├─┘└┬┘┌┼─╠═╝├─┤└─┐ │ ├┤
                    ╚═╝└─┘┴   ┴ └┘ ╩  ┴ ┴└─┘ ┴ └─┘
                    #########################################################
                -->
                <Separator />

                <!-- Copy Value (Ctrl+C) -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.HasValue,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Copy Value to Clipboard"
                    Command="ApplicationCommands.Copy"
                    CommandParameter="{Binding}"
                    CommandTarget="{Binding}">
                    <MenuItem.Icon>
                        <!-- Old icon Codicons#Copy -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentCopy"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Copy: Selection -->
                <MenuItem
                    Header="Copy from Array/Buffer"
                    Command="{Binding Path=CopySelectionCommand,
                                      Source={x:Reference redTreeView}}">
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}"
                                    Value="False">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>

                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsMultipleItemsSelected, Source={x:Reference redTreeView}}" Value="False" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Header" Value="Copy From Array/Buffer" />
                                </MultiDataTrigger>

                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsMultipleItemsSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />

                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Header" Value="Copy Selection from Array/Buffer" />
                                </MultiDataTrigger>

                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentCopy"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Copy: Handle (that is an array) -->
                <MenuItem
                    Header="Copy Handle"
                    Command="{Binding Path=CopySelectionCommand,
                                      Source={x:Reference redTreeView}}">
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsHandleSelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                        <Condition
                                            Binding="{Binding Path=IsArraySelected, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>

                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentCopy"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Copy: Array -->
                <MenuItem
                    Header="Copy item names"
                    Command="{Binding Path=CopySelectionNamesCommand, Source={x:Reference redTreeView}}">
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <!-- If shift pressed: Copy names -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArraySelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>


                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentCopy"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Copy: Array -->
                <MenuItem
                    Command="{Binding Path=PlacementTarget.Tag.CopyArrayContentsCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                    Header="Copy Array Contents">
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>

                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArraySelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>

                                <!-- If shift pressed: Copy names -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Command" Value="{Binding Path=CopySelectionNamesCommand, Source={x:Reference redTreeView}}" />
                                    <Setter Property="Header" Value="Copy item names" />
                                </MultiDataTrigger>

                                <!-- If shift pressed: Copy names -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Command"
                                            Value="{Binding Path=CopySelectionNamesCommand, Source={x:Reference redTreeView}}" />
                                    <Setter Property="Header" Value="Copy item names (as quoted list)" />
                                </MultiDataTrigger>

                                <!-- If shift pressed: Copy names (as quoted list) -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Command"
                                            Value="{Binding Path=CopySelectionNamesCommand, Source={x:Reference redTreeView}}" />
                                    <Setter Property="Header" Value="Copy item names (as quoted list)" />
                                </MultiDataTrigger>


                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>


                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentCopy"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>


                <!-- Paste Handle: Only available when pasting single selection handle onto an array item -->
                <MenuItem
                    Header="Paste as Handle (overwrite data)"
                    Command="{Binding Path=PasteHandleSingleCommand,
                                      Source={x:Reference redTreeView}}">
                    <!-- Hide this if we can only past multi selection -->
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=HasHandleCopied, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsHandleSelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>

                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- ======================================================== -->
                <!-- Paste single -->
                <!-- ======================================================== -->
                <MenuItem
                    Header="Paste Into Array/Buffer"
                    Command="{Binding Path=PasteSingleSelectionCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>

                                <!-- Hide if we shouldn't show array opts -->
                                <DataTrigger
                                    Binding="{Binding Path=ShouldShowArrayOps,
                                                      Source={x:Reference redTreeView}}"
                                    Value="False">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>

                                <!-- Hide if shift is down -->
                                <DataTrigger
                                    Binding="{Binding Path=IsShiftBeingHeld,
                                                      Source={x:Reference redTreeView}}"
                                    Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>

                                <!-- Hide if ctrl is down -->
                                <DataTrigger
                                    Binding="{Binding Path=IsCtrlBeingHeld,
                                                      Source={x:Reference redTreeView}}"
                                    Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>

                                <!-- Hide if we can only paste multi selection -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=HasSingleItemCopied, Source={x:Reference redTreeView}}" Value="False" />
                                        <Condition Binding="{Binding Path=HasMultipleItemsCopied, Source={x:Reference redTreeView}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Shift: Overwrite with single -->
                <MenuItem
                    Header="Overwrite Selection with Single"
                    Command="{Binding Path=OverwriteSelectionWithSingleCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=HasSingleItemCopied, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition
                                            Binding="{Binding Path=HasMultipleItemsSelected, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>

                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArraySelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=HasSingleItemCopied, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Header" Value="Overwrite Array/Buffer with Single" />
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Shift: Overwrite selected with selection -->
                <MenuItem
                    Header="Overwrite with Selection"
                    Command="{Binding Path=OverwriteSelectionWithPasteCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>

                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArraySelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=HasMultipleItemsCopied, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=HasMultipleItemsCopied, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                    <Setter Property="Header" Value="Overwrite with Selection" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Shift: Overwrite selected with selection -->
                <MenuItem
                    Header="Overwrite with Selection"
                    Command="{Binding Path=OverwriteSelectionWithPasteCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>

                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArraySelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=HasMultipleItemsCopied, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=HasMultipleItemsCopied, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                    <Setter Property="Header" Value="Overwrite with Selection" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>


                <!-- Ctrl: Clear parent and paste -->
                <MenuItem
                    Header="Clear Parent and Paste Single"
                    Command="{Binding Path=ClearAndPasteSingleCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition
                                            Binding="{Binding Path=HasMultipleItemsSelected, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                        <Condition Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>


                <!-- ======================================================== -->
                <!-- Paste multiple -->
                <!-- ======================================================== -->


                <!-- no modifiers: paste -->
                <MenuItem
                    Header="Paste Selection into Array/Buffer"
                    Command="{Binding Path=PasteSelectionCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Visible" />

                            <Style.Triggers>

                                <!-- Show if we should show array opts -->
                                <DataTrigger
                                    Binding="{Binding Path=ShouldShowArrayOps,
                                                      Source={x:Reference redTreeView}}"
                                    Value="False">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>

                                <!-- Hide if we don't have multiple items copied -->
                                <DataTrigger
                                    Binding="{Binding Path=HasMultipleItemsCopied,
                                                      Source={x:Reference redTreeView}}"
                                    Value="False">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>

                                <!-- Hide if shift key is down -->
                                <DataTrigger
                                    Binding="{Binding Path=IsShiftBeingHeld,
                                                      Source={x:Reference redTreeView}}"
                                    Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>

                                <!-- Hide if ctrl key is down -->
                                <DataTrigger
                                    Binding="{Binding Path=IsCtrlBeingHeld,
                                                      Source={x:Reference redTreeView}}"
                                    Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Ctrl: Clear parent and paste -->
                <MenuItem
                    Header="Clear Parent and Paste Selection"
                    Command="{Binding Path=ClearAndPasteSelectionCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                        <Condition Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="ContentPaste"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Shift+Ctrl: Clear parent -->
                <MenuItem
                    Header="Clear Parent"
                    Command="{Binding Path=ClearArrayCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="DeleteSweep"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <Separator />

                <!--
                    #########################################################
                    ╔╦╗┌─┐┬  ┌─┐┌┬┐┌─┐  ┌─┐┌─┐┌─┐┬─┐┌─┐┌┬┐┬┌─┐┌┐┌┌─┐
                    _║║├┤ │  ├┤  │ ├┤   │ │├─┘├┤ ├┬┘├─┤ │ ││ ││││└─┐
                    ═╩╝└─┘┴─┘└─┘ ┴ └─┘  └─┘┴  └─┘┴└─┴ ┴ ┴ ┴└─┘┘└┘└─┘
                    #########################################################0
                -->

                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowDynamicPropertyOperations,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Delete Property"
                    Command="{Binding Path=PlacementTarget.Tag.DeletePropertyCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <!-- Old icon Codicons#Remove -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Delete"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitRed}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Delete item -->
                <MenuItem
                    Header="Delete Item in Array/Buffer"
                    Command="{Binding Path=DeleteSelectionCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsMultipleItemsSelected, Source={x:Reference redTreeView}}" Value="False" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>

                                <!-- Change label if we have multiple items selected -->
                                <DataTrigger
                                    Binding="{Binding Path=HasMultipleItemsCopied,
                                                      ElementName=redTreeView}"
                                    Value="True">
                                    <Setter Property="Header" Value="Delete Selection in Array/Buffer" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <!-- Old icon Codicons#Remove -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Delete"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitRed}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Delete Selection -->
                <MenuItem
                    Header="Delete Selection in Array/Buffer"
                    Command="{Binding Path=DeleteSelectionCommand,
                                      Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsMultipleItemsSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <!-- Old icon Codicons#Remove -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Delete"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitRed}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Delete Everything But Selection -->
                <MenuItem
                    Header="Delete All but Selection in Array/Buffer"
                    Command="{Binding Path=DeleteAllButSelectionCommand,
                                      Source={x:Reference redTreeView}}">


                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}" Value="True" />
                                        <Condition Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>

                    <MenuItem.Icon>
                        <!-- Old icon Codicons#Remove -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="Delete"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitRed}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Delete All -->
                <MenuItem
                    Header="Clear Array/Buffer"
                    Command="{Binding Path=ClearArrayCommand, Source={x:Reference redTreeView}}">

                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource TreeViewMenuItemStyle}"
                            TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArrayItemSelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                    <Setter Property="Header" Value="Clear Parent Array/Buffer" />
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding Path=IsArraySelected, Source={x:Reference redTreeView}}"
                                            Value="True" />
                                        <Condition
                                            Binding="{Binding Path=IsShiftBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                        <Condition
                                            Binding="{Binding Path=IsCtrlBeingHeld, Source={x:Reference redTreeView}}"
                                            Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    
                    <MenuItem.Icon>
                        <!-- Old icon Material#NotificationClearAll -->
                        <templates:IconBox
                            IconPack="Material"
                            Kind="DeleteSweep"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitRed}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Reset Object -->
                <MenuItem
                    Style="{StaticResource TreeViewMenuItemStyle}"
                    Visibility="Visible"
                    Header="Reset Object"
                    Command="{Binding Path=PlacementTarget.Tag.ResetObjectCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="RestoreAlert"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitRed}" />
                    </MenuItem.Icon>
                </MenuItem>

                <Separator />

                <!--
                    #####################################################
                    ╦┌┬┐┌─┐┌─┐┬─┐┌┬┐  ╔═╗─┐ ┬┌─┐┌─┐┬─┐┌┬┐
                    ║│││├─┘│ │├┬┘ │   ║╣ ┌┴┬┘├─┘│ │├┬┘ │
                    ╩┴ ┴┴  └─┘┴└─ ┴   ╚═╝┴ └─┴  └─┘┴└─ ┴
                    #########################################################0
                -->

                <!-- Export Chunk (to JSON) -->
                <MenuItem
                    Header="Export to JSON"
                    Command="{Binding Path=PlacementTarget.Tag.ExportChunkCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="CodeJson"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Export World Node Data -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowExportNodeData,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Export NodeData to JSON"
                    Command="{Binding Path=PlacementTarget.Tag.ExportNodeDataCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="CodeJson"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Import World Node Data -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowWorldNodeDataImport,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Import from JSON to worldStreamingSector"
                    Command="{Binding Path=PlacementTarget.Tag.ImportWorldNodeDataCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="CodeJson"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Import from JSON -->
                <MenuItem
                    Visibility="{Binding Path=PlacementTarget.Tag.ShouldShowWorldNodeDataImport,
                                         RelativeSource={RelativeSource AncestorType=ContextMenu},
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Import from JSON (no coords update)"
                    Command="{Binding Path=PlacementTarget.Tag.ImportWorldNodeDataWithoutCoordsCommand,
                                      RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Material"
                            Kind="CodeJson"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Add To Project -->
                <MenuItem
                    Visibility="{Binding Path=IsEnabled,
                                         RelativeSource={RelativeSource Self},
                                         Mode=OneWay,
                                         Converter={StaticResource BooleanToVisibilityConverter}}"
                    Header="Add to project"
                    Command="{Binding Path=AddToProjectCommand, Source={x:Reference redTreeView}}">
                    <MenuItem.Icon>
                        <templates:IconBox
                            IconPack="Vaadin"
                            Kind="ArrowCircleLeft"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            Size="{DynamicResource WolvenKitIconMilli}"
                            Foreground="{StaticResource WolvenKitYellow}" />
                    </MenuItem.Icon>
                </MenuItem>
            </ContextMenu>

            <!-- Converter for the right-hand properties that decides which partial to render -->
            <converters:TreeViewItemTemplateSelector
                x:Key="itemTemplateSelector"
                x:Name="itemTemplateSelector">
                <converters:TreeViewItemTemplateSelector.GroupedTemplate>
                    <DataTemplate>
                        <Grid
                            HorizontalAlignment="Left"
                            Background="Transparent"
                            Tag="{Binding}">
                            <ContentPresenter
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource GroupedPropertyNameTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.GroupedTemplate>

                <converters:TreeViewItemTemplateSelector.PropertyTemplate>
                    <DataTemplate DataType="{x:Type shell:ChunkViewModel}">
                        <Grid
                            HorizontalAlignment="Left"
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.CommandBindings>
                                <CommandBinding
                                    CanExecute="Copy_CanExecute"
                                    Command="ApplicationCommands.Copy"
                                    Executed="Copy_Executed" />
                            </Grid.CommandBindings>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ContentPresenter
                                Grid.Column="0"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />

                            <ContentPresenter
                                Grid.Column="2"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.PropertyTemplate>

                <converters:TreeViewItemTemplateSelector.ArrayTemplate>
                    <DataTemplate>
                        <Grid
                            HorizontalAlignment="Left"
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ContentPresenter
                                Grid.Column="0"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />

                            <ContentPresenter
                                Grid.Column="2"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.ArrayTemplate>

                <converters:TreeViewItemTemplateSelector.HandleTemplate>
                    <DataTemplate>
                        <Grid
                            HorizontalAlignment="Left"
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ContentPresenter
                                Grid.Column="0"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />

                            <ContentPresenter
                                Grid.Column="1"
                                Width="Auto"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.HandleTemplate>

                <converters:TreeViewItemTemplateSelector.RefTemplate>
                    <DataTemplate>
                        <Grid
                            Width="Auto"
                            HorizontalAlignment="Stretch"
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" MinWidth="20" />
                                <ColumnDefinition Width="Auto" MinWidth="20" />
                            </Grid.ColumnDefinitions>

                            <ContentPresenter
                                Grid.Column="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />

                            <!--iconPacks:PackIconCodicons Kind="References" Height="14" Grid.Column="1"
                                        Width="14" VerticalAlignment="Center" HorizontalAlignment="Center"  Margin="0,0,6,0" />
                                    <TextBlock Text="{Binding Value}" Grid.Column="2" /-->

                            <ContentPresenter
                                Grid.Column="1"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />

                            <Button
                                Grid.Column="2"
                                Margin="{DynamicResource WolvenKitMarginTinyLeft}"
                                Background="Transparent"
                                Style="{StaticResource ButtonCustom}"
                                Command="{Binding OpenRefCommand}"
                                ToolTip="Open in new tab">
                                <iconPacks:PackIconMaterial
                                    Kind="TabPlus"
                                    Width="{DynamicResource WolvenKitIconMilli}"
                                    Height="{DynamicResource WolvenKitIconMilli}"
                                    Margin="{DynamicResource WolvenKitMarginTinyRight}"
                                    Foreground="{StaticResource WolvenKitCyan}" />
                            </Button>

                            <Button
                                Grid.Column="3"
                                Margin="{DynamicResource WolvenKitMarginTinyHorizontal}"
                                Background="Transparent"
                                Style="{StaticResource ButtonCustom}"
                                Command="{Binding AddRefCommand}"
                                ToolTip="Add File to Mod">
                                <iconPacks:PackIconVaadinIcons
                                    Kind="ArrowCircleLeft"
                                    Width="{DynamicResource WolvenKitIconMilli}"
                                    Height="{DynamicResource WolvenKitIconMilli}"
                                    Foreground="{StaticResource WolvenKitYellow}" />
                            </Button>
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.RefTemplate>

                <converters:TreeViewItemTemplateSelector.CurveTemplate>
                    <DataTemplate>
                        <Grid
                            Width="Auto"
                            HorizontalAlignment="Stretch"
                            Background="Transparent"
                            ContextMenu="{StaticResource TreeViewContextMenu}"
                            Tag="{Binding}"
                            ToolTip="{Binding Type}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource ArrayNameColumnWidth}" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" MinWidth="20" />
                            </Grid.ColumnDefinitions>

                            <ContentPresenter
                                Grid.Column="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyNameTemplate}" />

                            <ContentPresenter
                                Grid.Column="1"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ContentTemplate="{StaticResource PropertyValueTemplate}" />

                            <editors:RedCurveEditor
                                Grid.Column="2"
                                Margin="{DynamicResource WolvenKitMarginTinyRight}"
                                ShowQuickAccess="True" />
                        </Grid>
                    </DataTemplate>
                </converters:TreeViewItemTemplateSelector.CurveTemplate>
            </converters:TreeViewItemTemplateSelector>
        </ResourceDictionary>
    </UserControl.Resources>

    <syncfusion:SfTreeView
        x:Name="TreeView"
        Margin="-1"
        Background="{StaticResource ContentBackground}"
        BorderThickness="0"
        Visibility="Visible"
        AllowDragging="True"
        AllowEditing="False"
        AutoExpandMode="RootNodes"
        ItemHeight="{DynamicResource WolvenKitTreeRowHeight}"
        ItemDragOver="SfTreeView_ItemDragOver"
        ItemDragStarting="SfTreeView_ItemDragStarting"
        ItemDropping="SfTreeView_ItemDropping"
        ItemTemplateSelector="{StaticResource itemTemplateSelector}"
        ItemsSource="{Binding ElementName=redTreeView,
                              Path=ItemsSource,
                              Mode=TwoWay}"
        NodeCollapsed="OnCollapsed"
        NodeExpanded="OnExpanded"
        SelectedItem="{Binding ElementName=redTreeView,
                               Path=SelectedItem,
                               Mode=TwoWay}"
        SelectedItems="{Binding ElementName=redTreeView,
                                Path=SelectedItems,
                                Mode=TwoWay}"
        SelectionChanged="OnSelectionChanged"
        MouseDoubleClick="OnDoubleClick"
        SelectionMode="Extended"
        ShowLines="True"
        VirtualizingPanel.IsVirtualizing="True"
        VirtualizingPanel.ScrollUnit="Pixel"
        VirtualizingPanel.VirtualizationMode="Recycling">
        <!--
            LoadOnDemandCommand="{Binding OnDemandLoadingCommand}"
            QueryNodeSize="TreeView_QueryNodeSize"
        -->
        <syncfusion:SfTreeView.Resources />

        <syncfusion:SfTreeView.DragPreviewTemplate>
            <DataTemplate DataType="{x:Type syncfusion:TreeViewDragInfo}">
                <Border
                    BorderBrush="{StaticResource BorderAlt}"
                    BorderThickness="1">
                    <Grid Background="{StaticResource ContentBackgroundAlt2}">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            VerticalAlignment="Center"
                            Visibility="{Binding Data[0].Content.IsCtrlKeyPressed,
                                                 Converter={StaticResource BooleanToVisibilityConverter}}"
                            Text="Duplicate item to this index (release control to move)" />

                        <TextBlock
                            Grid.Row="0"
                            Margin="{DynamicResource WolvenKitMarginTiny}"
                            VerticalAlignment="Center"
                            Visibility="{Binding Data[0].Content.IsCtrlKeyPressed,
                                                 Converter={StaticResource InvertBooleanVisibilityConverter}}"
                            Text="Move item to this index (hold control to duplicate)" />

                        <StackPanel
                            Grid.Row="1"
                            Orientation="Horizontal">
                            <TextBlock
                                Margin="{DynamicResource WolvenKitMarginTiny}"
                                VerticalAlignment="Center"
                                Foreground="{StaticResource WolvenKitTan}"
                                Text="{Binding Data[0].Content.Type}" />

                            <TextBlock
                                Margin="{DynamicResource WolvenKitMarginTiny}"
                                VerticalAlignment="Center"
                                Text="{Binding Data[0].Content.Descriptor}" />
                        </StackPanel>
                    </Grid>
                </Border>
            </DataTemplate>
        </syncfusion:SfTreeView.DragPreviewTemplate>

        <syncfusion:SfTreeView.HierarchyPropertyDescriptors>
            <treeViewEngine:HierarchyPropertyDescriptor
                TargetType="{x:Type shell:ChunkViewModel}"
                ChildPropertyName="TVProperties"
                IsExpandedPropertyName="IsExpanded" />

            <treeViewEngine:HierarchyPropertyDescriptor
                TargetType="{x:Type shell:GroupedChunkViewModel}"
                ChildPropertyName="TVProperties"
                IsExpandedPropertyName="IsExpanded" />
        </syncfusion:SfTreeView.HierarchyPropertyDescriptors>
    </syncfusion:SfTreeView>
</UserControl>
