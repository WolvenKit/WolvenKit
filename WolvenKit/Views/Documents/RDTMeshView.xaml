<reactiveUi:ReactiveUserControl
    x:Class="WolvenKit.Views.Documents.RDTMeshView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ab3d="clr-namespace:Ab3d.Controls;assembly=Ab3d.PowerToys"
    xmlns:cameras="clr-namespace:Ab3d.Cameras;assembly=Ab3d.PowerToys"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:documents="clr-namespace:WolvenKit.ViewModels.Documents;assembly=WolvenKit.App"
    xmlns:dxControls="clr-namespace:Ab3d.DirectX.Controls;assembly=Ab3d.DXEngine.Wpf"
    xmlns:hx="http://helix-toolkit.org/wpf/SharpDX"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:ie="http://schemas.microsoft.com/expression/2010/interactions"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:reactiveUi="http://reactiveui.net"
    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
    xmlns:visuals="clr-namespace:Ab3d.Visuals;assembly=Ab3d.PowerToys"
    Margin="0"
    d:DataContext="{d:DesignInstance Type={x:Type documents:RDTMeshViewModel}}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:TypeArguments="documents:RDTMeshViewModel"
    BorderBrush="{StaticResource BorderAlt}"
    BorderThickness="1,0,1,1"
    mc:Ignorable="d">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition Width="1*" />
        </Grid.ColumnDefinitions>
        <syncfusion:SfGridSplitter Grid.Column="1" HorizontalAlignment="Stretch" />


        <hx:Viewport3DX
            Name="hxViewport"
            BackgroundColor="#121212"
            Camera="{Binding Camera}"
            CoordinateSystemLabelForeground="White"
            EffectsManager="{Binding EffectsManager}"
            EnableRenderFrustum="True"
            EnableRenderOrder="True"
            FXAALevel="High"
            ShowCoordinateSystem="True"
            UseDefaultGestures="False"
            ZoomExtentsWhenLoaded="True">
            <hx:Viewport3DX.InputBindings>
                <MouseBinding Command="hx:ViewportCommands.Rotate" Gesture="LeftClick" />
                <MouseBinding Command="hx:ViewportCommands.Pan" Gesture="MiddleClick" />
                <MouseBinding Command="hx:ViewportCommands.Rotate" Gesture="Shift+MiddleClick" />
            </hx:Viewport3DX.InputBindings>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseDown3D">
                    <ie:CallMethodAction MethodName="OnMouseDown3DHandler" TargetObject="{Binding}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <hx:DirectionalLight3D Direction="0, -1, 0" Color="White" />
            <hx:DirectionalLight3D Direction="0, 0, 1" Color="White" />
            <hx:DirectionalLight3D Direction="0, 0, -1" Color="White" />
            <hx:DirectionalLight3D Direction="1, 0, 0" Color="White" />
            <hx:DirectionalLight3D Direction="-1, 0, 0" Color="White" />
            <!--  hx:ShadowMap3D /  -->
            <hx:DynamicReflectionMap3D IsDynamicScene="True">
                <!--  hx:EnvironmentMap3D Texture="{Binding EnvironmentMap}" /  -->
                <hx:ItemsModel3D x:Name="hxContentVisual" ItemsSource="{Binding SelectedAppearance.ModelGroup}" />
            </hx:DynamicReflectionMap3D>
            <!--  hx:Element3DPresenter Content="{Binding GroupModel}" /  -->
        </hx:Viewport3DX>

        <StackPanel
            HorizontalAlignment="Stretch"
            VerticalAlignment="Top"
            Orientation="Vertical">

            <Expander
                Header="Assimp info"
                IsExpanded="False"
                Style="{StaticResource BaseStyle}"
                Visibility="Collapsed">
                <TextBlock
                    Name="FileFormatsTextBlock"
                    Margin="10,5,10,0"
                    Text=""
                    TextWrapping="Wrap" />
            </Expander>
        </StackPanel>

        <!--syncfusion:DropDownButton
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Label="Options">
            <syncfusion:DropDownButton.IconTemplate>
                <DataTemplate>
                    <iconPacks:PackIconRemixIcon
                        Width="12"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Kind="Settings2Fill" />
                </DataTemplate>
            </syncfusion:DropDownButton.IconTemplate>
            <Border
                Margin="5"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Background="Black"
                BorderBrush="Black"
                BorderThickness="2"
                Visibility="Visible">
                <StackPanel Margin="10,5" Orientation="Vertical">

                    <Button
                        Name="LoadButton"
                        Height="26"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Left"
                        Click="LoadButton_OnClick"
                        Content="Load file"
                        IsDefault="True"
                        Visibility="Collapsed" />

                    <TextBlock
                        Margin="0,4,0,0"
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="(or drag and drop 3D model file)"
                        Visibility="Collapsed" />
                    <CheckBox
                        Name="CameraTypeCheckBox"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Checked="CameraTypeCheckBox_Checked"
                        Content="Orthographic Camera"
                        IsChecked="True"
                        Unchecked="CameraTypeCheckBox_Checked" />
                    <CheckBox
                        Name="ShowWireframeCheckBox"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Checked="OnShowWireframeCheckBoxCheckedChanged"
                        Content="Show wireframe"
                        IsChecked="True"
                        Unchecked="OnShowWireframeCheckBoxCheckedChanged" />
                    <CheckBox
                        Name="AddLineDepthBiasCheckBox"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Checked="OnAddLineDepthBiasCheckBoxCheckedChanged"
                        Content="Add line depth bias (DXEngine only)"
                        IsChecked="True"
                        IsEnabled="{Binding ElementName=ShowWireframeCheckBox, Path=IsChecked}"
                        Unchecked="OnAddLineDepthBiasCheckBoxCheckedChanged" />
                    <CheckBox
                        Name="ReadPolygonIndicesCheckBox"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Checked="OnReadPolygonIndicesCheckBoxCheckedChanged"
                        Content="Read PolygonIndices"
                        IsChecked="True"
                        ToolTip="When checked ReaderObj will read PolygonIndices collection that can be used to show polygons instead of triangles. Object need to be shown with wireframe to see the difference."
                        Unchecked="OnReadPolygonIndicesCheckBoxCheckedChanged" />

                    <Button
                        Name="ShowInfoButton"
                        Margin="0,20,0,0"
                        Click="ShowInfoButton_OnClick"
                        Content="Show objects info"
                        IsEnabled="False" />
                </StackPanel>
            </Border>
        </syncfusion:DropDownButton-->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <StackPanel Orientation="Vertical">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />

                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Margin="5,0,0,0"
                        VerticalAlignment="Center"
                        Text="Appearance: " />
                    <ComboBox
                        Grid.Column="1"
                        Height="30"
                        Padding="10,0"
                        DisplayMemberPath="Name"
                        ItemsSource="{Binding Appearances, Mode=OneWay}"
                        SelectedItem="{Binding SelectedAppearance, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </Grid>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />

                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Margin="5,0,0,0"
                        VerticalAlignment="Center"
                        Text="LOD: " />
                    <ComboBox
                        Grid.Column="1"
                        Height="30"
                        Padding="10,0"
                        ItemsSource="{Binding SelectedAppearance.LODLUT.Keys, Mode=OneWay}"
                        SelectedItem="{Binding SelectedAppearance.SelectedLOD, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </Grid>
                <Button Click="ReloadModels" Content="Zoom to Extents" />
                <Button
                    Command="{Binding LoadMaterialsCommand}"
                    Content="Load Materials for Appearance"
                    IsEnabled="{Binding IsLoadingMaterials, Converter={StaticResource InvertBooleanConverter}}" />
                <Button Command="{Binding ExtractShadersCommand}" Content="Export Shaders" />

                <!--ItemsControl ItemsSource="{Binding Sectors, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel
                                IsVirtualizing="True"
                                Orientation="Vertical"
                                VirtualizationMode="Recycling" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.Template>
                        <ControlTemplate TargetType="ItemsControl">
                            <ScrollViewer
                                MaxHeight="500"
                                CanContentScroll="True"
                                Focusable="False">
                                <ItemsPresenter />
                            </ScrollViewer>
                        </ControlTemplate>
                    </ItemsControl.Template>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox IsChecked="{Binding ShowElements, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding IsLoaded, UpdateSourceTrigger=PropertyChanged}" />
                                <TextBlock Text="{Binding NumberOfHandles}" />
                                <Button
                                    Command="{Binding DataContext.LoadSectorCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                    CommandParameter="{Binding}"
                                    Content="{Binding Name}"
                                    IsEnabled="{Binding IsLoaded, Converter={StaticResource InvertBooleanConverter}, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </I-->
            </StackPanel>
            <!--syncfusion:SfTreeGrid
                Grid.Row="1"
                AllowResizingColumns="True"
                AutoExpandMode="AllNodesExpanded"
                AutoGenerateColumns="False"
                CheckBoxMappingName="IsEnabled"
                ChildPropertyName="BindName"
                ItemsSource="{Binding SelectedAppearance.Models, Mode=TwoWay}"
                NodeCheckStateChanged="SfTreeGrid_NodeCheckStateChanged"
                ParentPropertyName="Name"
                RowHeaderWidth="300"
                ShowCheckBox="True">
                <syncfusion:SfTreeGrid.Columns>
                    <syncfusion:TreeGridTextColumn
                        HeaderText="Component Name"
                        MappingName="Name"
                        MinimumWidth="300" />
                    <syncfusion:TreeGridTemplateColumn HeaderText="Chunk Mask">
                        <syncfusion:TreeGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <syncfusion:ComboBoxAdv
                                    AllowMultiSelect="True"
                                    Background="#252525"
                                    BorderThickness="0"
                                    ItemsSource="{Binding AllChunks, Mode=OneTime}"
                                    SelectedItems="{Binding EnabledChunks, Mode=TwoWay}"
                                    SelectedValueDelimiter=", "
                                    SelectionChanged="ComboBoxAdv_SelectionChanged" />
                            </DataTemplate>
                        </syncfusion:TreeGridTemplateColumn.CellTemplate>
                    </syncfusion:TreeGridTemplateColumn>
                    <syncfusion:TreeGridTextColumn HeaderText="Bind Name" MappingName="BindName" />
                    <syncfusion:TreeGridTextColumn HeaderText="Slot Name" MappingName="SlotName" />
                    <syncfusion:TreeGridTextColumn HeaderText="Material" MappingName="Materials[0].Name" />
                </syncfusion:SfTreeGrid.Columns>
            </syncfusion:SfTreeGrid-->
            <syncfusion:SfTreeGrid
                Grid.Row="1"
                AllowResizingColumns="True"
                AutoExpandMode="AllNodesExpanded"
                AutoGenerateColumns="False"
                CheckBoxMappingName="IsRendering"
                ChildPropertyName="Children"
                ItemsSource="{Binding SelectedAppearance.ModelGroup, Mode=TwoWay}"
                NodeCheckStateChanged="SfTreeGrid_NodeCheckStateChanged"
                RowHeaderWidth="300"
                SelectedItem="{Binding SelectedItem}"
                ShowCheckBox="True">
                <syncfusion:SfTreeGrid.Columns>
                    <syncfusion:TreeGridTextColumn
                        HeaderText="Component Name"
                        MappingName="Name"
                        MinimumWidth="100" />
                    <!--syncfusion:TreeGridTemplateColumn HeaderText="Chunk Mask">
                        <syncfusion:TreeGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <syncfusion:ComboBoxAdv
                                    AllowMultiSelect="True"
                                    Background="#252525"
                                    BorderThickness="0"
                                    ItemsSource="{Binding AllChunks, Mode=OneTime}"
                                    SelectedItems="{Binding EnabledChunks, Mode=TwoWay}"
                                    SelectedValueDelimiter=", "
                                    SelectionChanged="ComboBoxAdv_SelectionChanged" />
                            </DataTemplate>
                        </syncfusion:TreeGridTemplateColumn.CellTemplate>
                    </syncfusion:TreeGridTemplateColumn-->
                    <syncfusion:TreeGridTextColumn HeaderText="Appearance" MappingName="AppearanceName" />
                    <syncfusion:TreeGridTextColumn
                        HeaderText="Material"
                        MappingName="MaterialName"
                        MinimumWidth="100" />
                    <syncfusion:TreeGridTextColumn
                        HeaderText="DepotPath"
                        MappingName="DepotPath"
                        MinimumWidth="100" />
                </syncfusion:SfTreeGrid.Columns>
            </syncfusion:SfTreeGrid>
            <!--ItemsControl ItemsSource="{Binding SelectedAppearance.Models, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.Template>
                            <ControlTemplate>
                                <ItemsPresenter />
                            </ControlTemplate>
                        </ItemsControl.Template>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="5,0,0,0" Orientation="Vertical">
                                    <CheckBox
                                        Margin="0,2"
                                        Checked="ReloadModels"
                                        IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                        Unchecked="ReloadModels">
                                        <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                                    </CheckBox>
                                    <TextBlock
                                        Margin="20,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="{Binding BindName, StringFormat='bind: {0}'}" />
                                    <TextBlock
                                        Margin="20,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="{Binding SlotName, StringFormat='slot: {0}'}" />
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl-->
        </Grid>
    </Grid>
</reactiveUi:ReactiveUserControl>
